<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Wusooly</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
        
        :root {
            --bg-color: #F8F9FA; --header-bg: #FFFFFF; --text-main: #333; --text-sub: #888;
            --accent-color: #0056b3; --card-bg: #FFFFFF; --input-bg: #F2F2F7;
            --border-color: #eee; --danger-color: #ff4747;
            --shadow-soft: 0 5px 20px rgba(0,0,0,0.05);
        }

        body.dark-mode {
            --bg-color: #121212; --header-bg: #1C1C1E; --text-main: #FFFFFF; --text-sub: #A1A1A1;
            --accent-color: #4dabf7; --card-bg: #2C2C2E; --input-bg: #3A3A3C;
            --border-color: #444;
        }

        * { box-sizing: border-box; transition: 0.3s; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-main); padding-bottom: 90px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¨Ø³ÙŠØ· */
        header { padding: 20px; text-align: center; background: transparent; }
        .page-title { font-weight: 800; font-size: 18px; margin: 0; }

        .container { max-width: 500px; margin: 0 auto; padding: 0 20px; }

        /* Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø§Ø³Ù… */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .avatar-container { 
            position: relative; width: 110px; height: 110px; margin: 0 auto 15px; 
            border-radius: 50%; padding: 3px; border: 2px solid var(--accent-color); 
        }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; background: var(--input-bg); }
        .edit-badge {
            position: absolute; bottom: 5px; right: 5px;
            background: var(--accent-color); color: white;
            width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--card-bg); cursor: pointer;
        }
        .user-fullname { font-size: 20px; font-weight: 800; margin: 0; }
        .user-role { font-size: 13px; color: var(--text-sub); margin-top: 5px; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù†ÙŠÙ‚Ø© (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©) */
        .menu-list { background: var(--card-bg); border-radius: 20px; padding: 10px 20px; box-shadow: var(--shadow-soft); }
        .menu-item { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 18px 0; border-bottom: 1px solid var(--border-color); 
            cursor: pointer; 
        }
        .menu-item:last-child { border-bottom: none; }
        
        .menu-left { display: flex; align-items: center; gap: 15px; }
        .menu-icon { 
            width: 35px; height: 35px; border-radius: 10px; 
            background: var(--input-bg); color: var(--accent-color);
            display: flex; align-items: center; justify-content: center; 
        }
        .menu-text { font-weight: 600; font-size: 15px; }
        .arrow-icon { color: var(--text-sub); width: 18px; }

        /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
        .logout-btn {
            background: var(--accent-color); color: white;
            width: 100%; padding: 15px; border-radius: 15px;
            border: none; font-weight: bold; font-size: 16px;
            margin-top: 25px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* --- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©) --- */
        .edit-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 2000;
            padding: 20px; overflow-y: auto;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .edit-modal.open { transform: translateY(0); }

        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
        .back-btn { width: 40px; height: 40px; border-radius: 12px; background: var(--input-bg); display: flex; align-items: center; justify-content: center; cursor: pointer; }

        .form-group { margin-bottom: 20px; }
        .label { display: block; font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; }
        .input-field {
            width: 100%; padding: 15px; border-radius: 15px;
            border: 1px solid var(--border-color); background: var(--card-bg);
            color: var(--text-main); font-family: 'Cairo'; font-weight: 600;
            font-size: 15px;
        }
        .input-field:focus { border-color: var(--accent-color); outline: none; }
        
        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØºÙ„Ù‚Ø© */
        .input-field:disabled { background: var(--input-bg); color: var(--text-sub); cursor: not-allowed; border: 1px dashed var(--border-color); }
        .lock-hint { font-size: 11px; color: var(--danger-color); margin-top: 5px; display: flex; align-items: center; gap: 4px; }

        .save-btn {
            background: var(--accent-color); color: white; width: 100%; padding: 16px;
            border-radius: 50px; border: none; font-weight: bold; font-size: 16px;
            position: sticky; bottom: 20px; margin-top: 20px; cursor: pointer;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¶ÙŠÙ */
        .guest-view { text-align: center; padding: 50px 20px; display: none; }
        .google-btn { background: white; color: #333; padding: 12px 25px; border-radius: 50px; font-weight: bold; border: 1px solid #ddd; display: inline-flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 20px; }

        .loading { text-align: center; padding: 20px; color: var(--text-sub); }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
        .floating-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--header-bg); height: 70px; border-radius: 25px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 900; }
        .nav-link svg { width: 26px; height: 26px; stroke: #999; fill: none; stroke-width: 2; }
        .nav-link.active svg { stroke: var(--accent-color); }
        @media (min-width: 769px) { .floating-nav { display: none; } }
    </style>
</head>
<body>

    <div id="loading-screen" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

    <div id="user-view" style="display: none;">
        <header>
            <h1 class="page-title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h1>
        </header>

        <div class="container">
            <div class="profile-header">
                <div class="avatar-container">
                    <img id="main-avatar" src="" class="profile-img">
                    <div class="edit-badge" onclick="openEditModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    </div>
                </div>
                <h2 id="main-name" class="user-fullname">...</h2>
                <div id="main-role" class="user-role">Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ²</div>
            </div>

            <div class="menu-list">
                <div class="menu-item" onclick="openEditModal()">
                    <div class="menu-left">
                        <div class="menu-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                        <span class="menu-text">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
                    </div>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </div>

                <div class="menu-item">
                    <div class="menu-left">
                        <div class="menu-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg></div>
                        <span class="menu-text">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†</span>
                    </div>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </div>

                <div class="menu-item" onclick="contactAdmin()">
                    <div class="menu-left">
                        <div class="menu-icon" style="color:#ff4747; background:rgba(255, 71, 71, 0.1);"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></div>
                        <span class="menu-text">ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù…/Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</span>
                    </div>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </div>
            </div>

            <button class="logout-btn" id="logout-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>

    <div id="guest-view" class="guest-view">
        <span style="font-size:60px; display:block; margin-bottom:20px;">ğŸ”’</span>
        <h2>Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹</h2>
        <p style="color:var(--text-sub)">Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
        <button id="login-btn" class="google-btn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google
        </button>
    </div>

    <div id="edit-modal" class="edit-modal">
        <div class="modal-header">
            <div class="back-btn" onclick="closeEditModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
            </div>
            <h3 style="margin:0;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <div style="width:40px;"></div>
        </div>

        <div class="form-group">
            <label class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
            <input type="text" id="inp-fname" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„">
        </div>
        <div class="form-group">
            <label class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
            <input type="text" id="inp-sname" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ">
        </div>
        
        <div class="form-group">
            <label class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="text" id="inp-phone" class="input-field" disabled>
            <div class="lock-hint">ğŸ”’ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        </div>

        <div class="form-group">
            <label class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="inp-email" class="input-field" disabled>
            <div class="lock-hint">ğŸ”’ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        </div>

        <div class="form-group">
            <label class="label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
            <input type="text" id="inp-city" class="input-field">
        </div>

        <div class="form-group">
            <label class="label">Ø§Ù„Ø´Ø§Ø±Ø¹</label>
            <input type="text" id="inp-street" class="input-field">
        </div>

        <button class="save-btn" onclick="saveData()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>

    <div class="floating-nav">
        <a href="index.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a>
        <a href="cart.html" class="nav-link"><svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg></a>
        <a href="#" class="nav-link active"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></a>
    </div>

    <script>
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa0RwEcbVqWYAKeUFeZy2IDihaxUxtNKY",
            authDomain: "wusooly-1906b.firebaseapp.com",
            projectId: "wusooly-1906b",
            storageBucket: "wusooly-1906b.firebasestorage.app",
            messagingSenderId: "95836343161",
            appId: "1:95836343161:web:73ae3faaca406c0bf7fda8",
            measurementId: "G-2704R4YR1M"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        let currentUser = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        onAuthStateChanged(auth, async (user) => {
            document.getElementById('loading-screen').style.display = 'none';
            if (user) {
                currentUser = user;
                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Firestore
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    document.getElementById('main-name').innerText = `${data.firstName} ${data.secondName}`;
                    document.getElementById('main-avatar').src = user.photoURL || "https://via.placeholder.com/150";
                    
                    // ØªØ¹Ø¨Ø¦Ø© ÙÙˆØ±Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù„ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø©)
                    document.getElementById('inp-fname').value = data.firstName;
                    document.getElementById('inp-sname').value = data.secondName;
                    document.getElementById('inp-phone').value = data.phone; // Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·
                    document.getElementById('inp-email').value = user.email; // Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·
                    document.getElementById('inp-city').value = data.city;
                    document.getElementById('inp-street').value = data.street;

                    document.getElementById('user-view').style.display = 'block';
                } else {
                    // ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„ ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (Ù†Ø§Ø¯Ø±)
                    alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");
                    window.location.reload(); 
                }
            } else {
                document.getElementById('guest-view').style.display = 'block';
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†Ø§ÙØ°Ø©)
        window.openEditModal = () => document.getElementById('edit-modal').classList.add('open');
        window.closeEditModal = () => document.getElementById('edit-modal').classList.remove('open');
        
        window.contactAdmin = () => {
            alert("Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:\nğŸ“§ support@wusooly.com\nğŸ“ 059xxxxxxx");
        };

        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        window.saveData = async () => {
            const fname = document.getElementById('inp-fname').value;
            const sname = document.getElementById('inp-sname').value;
            const city = document.getElementById('inp-city').value;
            const street = document.getElementById('inp-street').value;
            
            const btn = document.querySelector('.save-btn');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

            try {
                await updateDoc(doc(db, "users", currentUser.uid), {
                    firstName: fname,
                    secondName: sname,
                    city: city,
                    street: street
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
                document.getElementById('main-name').innerText = `${fname} ${sname}`;
                closeEditModal();
                alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
            }
            btn.innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª";
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬
        document.getElementById('login-btn').addEventListener('click', () => signInWithPopup(auth, provider));
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth).then(() => location.reload()));
    </script>
</body>
</html>
