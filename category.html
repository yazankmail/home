<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„ØªØµÙ†ÙŠÙ - Wusooly</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
        
        :root {
            --bg-color: #f8f9fa; --header-bg: #ffffff; --text-main: #333333; --text-sub: #777777;
            --accent-color: #0056b3; /* Ø§Ù„Ø£Ø²Ø±Ù‚ */
            --price-color: #0056b3; /* Ù„ÙˆÙ† Ø§Ù„Ø³Ø¹Ø± */
            --card-bg: #ffffff; --input-bg: #f9f9f9;
            --nav-bar-bg: #ffffff; --nav-text: #999999; --nav-active: #0056b3;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.06); --radius-lg: 20px;
        }

        body.dark-mode {
            --bg-color: #121212; --header-bg: #1C1C1E; --text-main: #ffffff; --text-sub: #aaaaaa;
            --accent-color: #4dabf7; --price-color: #4dabf7;
            --card-bg: #2C2C2E; --input-bg: #3A3A3C;
            --nav-bar-bg: #2C2C2E; --nav-text: #636366; --nav-active: #ffffff;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-main); padding-bottom: 100px; overflow-x: hidden; }
        a { text-decoration: none; color: inherit; }

        /* Header Minimal */
        header { padding: 15px 20px; background-color: var(--header-bg); position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 5px rgba(0,0,0,0.03); }
        .logo-img { height: 24px; width: auto; }
        .back-btn { cursor: pointer; width: 40px; height: 40px; border-radius: 50%; background: var(--input-bg); display: flex; align-items: center; justify-content: center; }
        .page-title { font-size: 18px; font-weight: 800; color: var(--text-main); }

        /* Filters (Chips) - Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© */
        .filters-scroll { display: flex; gap: 10px; padding: 15px 20px; overflow-x: auto; scrollbar-width: none; }
        .filters-scroll::-webkit-scrollbar { display: none; }
        .filter-chip { 
            padding: 8px 20px; 
            background: var(--card-bg); 
            border: 1px solid var(--input-bg); 
            border-radius: 30px; 
            font-size: 13px; 
            font-weight: 600; 
            color: var(--text-sub); 
            white-space: nowrap; 
            cursor: pointer;
            transition: 0.2s;
        }
        .filter-chip.active { background: var(--accent-color); color: #fff; border-color: var(--accent-color); }

        /* Grid Layout - ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            padding: 0 20px; 
        }

        .product-card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            padding: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„ØªÙ…Ù„Ø£ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ±Øª */
            position: relative; 
            box-shadow: var(--shadow-soft); 
            border: none;
            overflow: hidden;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØµÙˆØ±Ø© */
        .img-container {
            position: relative;
            width: 100%;
            padding-top: 110%; /* Ù†Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹Ø©/Ø·ÙˆÙŠÙ„Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            background: var(--input-bg);
            border-radius: 20px;
            overflow: hidden;
        }

        .product-img { 
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%; 
            object-fit: cover; 
        }

        /* Ø²Ø± Ø§Ù„Ù‚Ù„Ø¨ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø«Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨) */
        .heart-btn {
            position: absolute;
            top: 10px;
            right: 10px; /* Ù„Ù„ÙŠÙ…ÙŠÙ† Ù„Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø±Ø¨ÙŠ RTLØŒ ÙŠÙ…ÙƒÙ† Ø¹ÙƒØ³Ù‡ Ù„Ù„ÙŠØ³Ø§Ø± Ø¨Ù€ left */
            width: 32px; height: 32px;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            color: #888;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .heart-btn.active { color: #ff4747; }

        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ */
        .product-details { padding: 10px 5px; }
        
        .product-name { 
            font-size: 14px; 
            font-weight: 700; 
            color: var(--text-main); 
            margin-bottom: 4px;
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }

        .rating-row {
            display: flex; align-items: center; gap: 4px;
            font-size: 11px; color: var(--text-sub);
            margin-bottom: 6px;
        }
        .star { color: #FFC107; font-size: 12px; }

        .price-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .product-price { 
            font-size: 16px; 
            font-weight: 800; 
            color: var(--price-color); 
        }

        .loading-msg { text-align: center; color: var(--text-sub); width: 100%; grid-column: span 2; padding: 40px 0; }

        /* Floating Nav */
        .floating-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background-color: var(--nav-bar-bg); height: 70px; border-radius: 25px; display: flex; justify-content: space-around; align-items: center; padding: 0 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 999; border: 1px solid rgba(0,0,0,0.05); }
        .nav-link { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--nav-text); text-decoration: none; transition: 0.3s; gap: 4px; }
        .nav-link svg { width: 26px; height: 26px; stroke-width: 2; fill: none; stroke: currentColor; }
        .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 50px; padding: 12px; position: fixed; z-index: 2000; left: 50%; bottom: 110px; transform: translateX(-50%); font-size: 14px; opacity: 0; transition: opacity 0.3s; }
        .toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </a>
        <div id="cat-title" class="page-title">Ø§Ù„ØªØµÙ†ÙŠÙ</div>
        <div style="width: 40px;"></div> </header>

    <div class="filters-scroll">
        <div class="filter-chip active">Ø§Ù„ÙƒÙ„</div>
        <div class="filter-chip">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</div>
        <div class="filter-chip">Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ø§Ù‹</div>
        <div class="filter-chip">Ø¬Ø¯ÙŠØ¯Ù†Ø§</div>
    </div>

    <div id="product-container" class="product-grid">
        <div class="loading-msg">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª... ğŸ“¦</div>
    </div>

    <div class="floating-nav">
        <a href="index.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a>
        <a href="#" class="nav-link"><svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg></a>
        <a href="profile.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></a>
    </div>

    <div id="toast" class="toast">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…</div>

    <script>
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ù„Ø©
        window.addToCart = function(name, price, image) {
            let cart = JSON.parse(localStorage.getItem('wusooly_cart')) || [];
            let existingItem = cart.find(item => item.name === name);
            if (existingItem) existingItem.qty += 1;
            else cart.push({ name: name, price: price, image: image, qty: 1 });
            localStorage.setItem('wusooly_cart', JSON.stringify(cart));
            
            const toast = document.getElementById("toast");
            toast.className = "toast show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa0RwEcbVqWYAKeUFeZy2IDihaxUxtNKY",
            authDomain: "wusooly-1906b.firebaseapp.com",
            projectId: "wusooly-1906b",
            storageBucket: "wusooly-1906b.firebasestorage.app",
            messagingSenderId: "95836343161",
            appId: "1:95836343161:web:73ae3faaca406c0bf7fda8",
            measurementId: "G-2704R4YR1M"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadCategory() {
            const urlParams = new URLSearchParams(window.location.search);
            const categoryName = urlParams.get('cat');
            const container = document.getElementById('product-container');
            const title = document.getElementById('cat-title');

            if (!categoryName) {
                title.innerText = "Ø§Ù„ÙƒÙ„";
                // ÙŠÙ…ÙƒÙ† Ù‡Ù†Ø§ Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­Ø¯Ø¯ ØªØµÙ†ÙŠÙ
            } else {
                title.innerText = categoryName;
            }

            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                let q;
                if(categoryName) {
                    q = query(collection(db, "products"), where("category", "==", categoryName));
                } else {
                    q = collection(db, "products");
                }
                
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    container.innerHTML = '<div class="loading-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ“­</div>';
                    return;
                }

                container.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const product = doc.data();
                    
                    // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ØªÙ‚ÙŠÙŠÙ… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ù…Ù†Ø¸Ø± Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠ (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©)
                    const rating = (Math.random() * (5.0 - 4.0) + 4.0).toFixed(1);

                    const html = `
                    <div class="product-card" onclick="window.addToCart('${product.name}', ${product.price}, '${product.image}')">
                        <div class="img-container">
                            <img src="${product.image}" class="product-img">
                            <div class="heart-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                            </div>
                        </div>
                        
                        <div class="product-details">
                            <div class="product-name">${product.name}</div>
                            <div class="rating-row">
                                <span class="star">â˜…</span>
                                <span>${rating} | ØªÙ… Ø¨ÙŠØ¹ 120</span>
                            </div>
                            <div class="price-row">
                                <div class="product-price">$${product.price}</div>
                            </div>
                        </div>
                    </div>
                    `;
                    container.innerHTML += html;
                });

            } catch (error) {
                console.error(error);
                container.innerHTML = '<div class="loading-msg">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© âš ï¸</div>';
            }
        }

        loadCategory();
    </script>
</body>
</html>
